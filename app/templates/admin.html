{% extends "base.html" %}
{% block title %}Admin | Reliable Walks{% endblock %}
{% block content %}
<section class="admin-panel">
  <div class="container admin-container" id="admin-chat" data-role="admin-chat">
    <button
      type="button"
      class="button ghost admin-back"
      data-role="admin-back"
      hidden
    >
      <span class="admin-back__icon" aria-hidden="true">&larr;</span>
      <span>Back to dashboard</span>
    </button>
    <div class="admin-grid" data-role="admin-grid">
      <article class="admin-card conversation-card" data-card id="live-conversations">
        <div
          class="card-preview"
          data-card-toggle
          role="button"
          tabindex="0"
          aria-expanded="false"
          aria-controls="conversation-card-body"
        >
          <div class="card-preview__header">
            <div class="card-preview__heading">
              <span class="eyebrow">Live Support</span>
              <h2>Live Conversations</h2>
            </div>
            <span
              class="chat-status-indicator is-off"
              data-role="live-chat-status"
              role="status"
              aria-live="polite"
            >
              Live chat is OFF — Autopilot replies instantly.
            </span>
          </div>
          <p class="card-summary-line" data-role="conversation-summary"></p>
          <span class="card-toggle-hint" aria-hidden="true">Open inbox</span>
        </div>
        <div class="card-body" id="conversation-card-body" data-card-body hidden>
          <div class="live-support-shell" data-role="conversation-overview">
            <div class="live-support-main">
              <section class="live-support-inbox">
                <header class="live-support-inbox__header">
                  <h4>Inbox</h4>
                  <p>Glance at every visitor who is waiting or mid-conversation.</p>
                </header>
                <aside
                  class="visitor-list"
                  data-role="visitor-list"
                  aria-label="Visitor conversations"
                ></aside>
              </section>
              <section class="live-support-stage">
                <div class="conversation-layout">
                  <div class="conversation-panel" data-role="conversation-panel">
                    <header class="chat-header">
                      <div class="chat-presence">
                        <span
                          class="presence-indicator"
                          data-role="presence-indicator"
                          aria-hidden="true"
                        ></span>
                        <div class="chat-presence__content">
                          <p class="presence-label" data-role="presence-label">
                            Autopilot concierge
                          </p>
                          <h3 class="visitor-heading" data-role="visitor-heading">
                            No active visitors
                          </h3>
                          <div class="chat-presence__meta">
                            <span class="visitor-status-tag" data-role="visitor-status"></span>
                            <span class="chat-mode-chip" data-role="chat-mode-chip">
                              AI assistant is replying
                            </span>
                          </div>
                        </div>
                      </div>
                      <div class="chat-toolbar">
                        <span class="chat-toolbar__status" data-role="chat-mode">Autopilot</span>
                        <span class="chat-toolbar__target">
                          Response target <strong data-role="response-target">under 2m</strong>
                        </span>
                      </div>
                    </header>
                    <div
                      class="chat-window"
                      data-chat-messages
                      data-placeholder="Select a visitor to view their messages."
                      aria-live="polite"
                    ></div>
                    <p class="chat-hint" data-role="chat-hint">
                      Autopilot is active. Disable it to respond manually.
                    </p>
                    <form id="agent-reply-form" class="reply-form">
                      <label class="field-label" for="agent-message">Reply to visitor</label>
                      <textarea
                        id="agent-message"
                        rows="4"
                        placeholder="Type your message to the visitor..."
                        required
                      ></textarea>
                      <div class="form-actions">
                        <button type="submit" class="button secondary">Send Reply</button>
                        <p class="form-feedback" data-role="agent-feedback"></p>
                      </div>
                    </form>
                  </div>
                  <aside
                    class="conversation-insights"
                    data-role="conversation-insights"
                    aria-live="polite"
                    hidden
                  >
                    <div class="insights-header">
                      <h4>Conversation insights</h4>
                      <p class="insights-empty" data-role="insights-empty">
                        Pick a visitor from the inbox to see their context here.
                      </p>
                    </div>
                    <dl class="insights-list" data-role="insights-list" hidden>
                      <div class="insights-row">
                        <dt>Last seen</dt>
                        <dd data-role="insight-last-seen">—</dd>
                      </div>
                      <div class="insights-row">
                        <dt>Last message</dt>
                        <dd data-role="insight-last-message">—</dd>
                      </div>
                      <div class="insights-row">
                        <dt>Visits</dt>
                        <dd data-role="insight-visit-count">—</dd>
                      </div>
                      <div class="insights-row">
                        <dt>Current page</dt>
                        <dd data-role="insight-last-path">—</dd>
                      </div>
                    </dl>
                    <div class="insights-timeline" data-role="insights-timeline" hidden>
                      <h5>Recent site activity</h5>
                      <ol class="timeline-list" data-role="timeline-list"></ol>
                      <p class="timeline-empty" data-role="timeline-empty">
                        This visitor hasn’t browsed enough pages yet.
                      </p>
                    </div>
                  </aside>
                </div>
              </section>
            </div>
          </div>
        </div>
      </article>
      <article class="admin-card visitor-card" data-card data-role="visitor-insights">
        <div
          class="card-preview"
          data-card-toggle
          role="button"
          tabindex="0"
          aria-expanded="false"
          aria-controls="visitor-card-body"
        >
          <div class="card-preview__header">
            <span class="eyebrow">Visitor Intelligence</span>
            <h2>Website Visitors</h2>
            <p class="card-subtitle">Monitor real-time traffic and see who’s waiting.</p>
          </div>
          <div class="visitor-card__alert">
            <a
              class="admin-alert"
              data-role="waiting-alert"
              aria-live="assertive"
              href="#live-conversations"
              hidden
            >
              A visitor is waiting for a live reply.
            </a>
          </div>
          <dl class="card-glance">
            <div class="card-glance__item">
              <dt>Total visitors</dt>
              <dd class="card-glance__value" data-role="visitor-total">0</dd>
            </div>
            <div class="card-glance__item">
              <dt>Returning</dt>
              <dd class="card-glance__value" data-role="visitor-returning">0</dd>
            </div>
            <div class="card-glance__item">
              <dt>Visits logged</dt>
              <dd class="card-glance__value" data-role="visitor-total-visits">0</dd>
            </div>
          </dl>
          <span class="card-toggle-hint" aria-hidden="true">Expand insights</span>
        </div>
        <div class="card-body" id="visitor-card-body" data-card-body hidden>
          <div class="card-body__toolbar">
            <button type="button" class="button ghost" data-role="visitor-refresh">
              Refresh
            </button>
            <p class="form-feedback" data-role="visitor-feedback"></p>
          </div>
          <div class="visitor-table" role="table">
            <div class="visitor-table__head" role="row">
              <span role="columnheader">Visitor</span>
              <span role="columnheader">Insights</span>
              <span role="columnheader">Timeline</span>
              <span role="columnheader" class="actions-header">Actions</span>
            </div>
            <div class="visitor-table__body" data-role="visitor-table-body"></div>
            <p class="visitor-empty" data-role="visitor-empty">
              Visitor activity will appear here the moment someone lands on the site.
            </p>
          </div>
        </div>
      </article>
      <article class="admin-card schedule-card" data-card data-role="schedule-manager">
        <div
          class="card-preview"
          data-card-toggle
          role="button"
          tabindex="0"
          aria-expanded="false"
          aria-controls="schedule-card-body"
        >
          <div class="card-preview__header">
            <span class="eyebrow">Scheduling Studio</span>
            <h2>Booking Slots</h2>
            <p class="card-subtitle">Publish availability, track reservations, and confirm walks.</p>
          </div>
          <dl class="card-glance">
            <div class="card-glance__item">
              <dt>Open slots</dt>
              <dd class="card-glance__value" data-role="admin-slot-count">0</dd>
            </div>
            <div class="card-glance__item">
              <dt>Bookings</dt>
              <dd class="card-glance__value" data-role="admin-booking-count">0</dd>
            </div>
          </dl>
          <span class="card-toggle-hint" aria-hidden="true">Manage availability</span>
        </div>
        <div class="card-body" id="schedule-card-body" data-card-body hidden>
          <form id="slot-form" class="slot-form" data-role="slot-form" novalidate>
            <div class="slot-form-grid">
              <label>
                Date
                <input type="date" name="date" required />
              </label>
              <label>
                Time
                <select name="time" required>
                  <option value="" disabled selected>Pick a start time</option>
                  <option value="07:00">07:00</option>
                  <option value="08:00">08:00</option>
                  <option value="09:00">09:00</option>
                  <option value="10:00">10:00</option>
                  <option value="11:00">11:00</option>
                  <option value="12:00">12:00</option>
                  <option value="13:00">13:00</option>
                  <option value="14:00">14:00</option>
                  <option value="15:00">15:00</option>
                  <option value="16:00">16:00</option>
                  <option value="17:00">17:00</option>
                </select>
              </label>
              <label>
                Walk length
                <select name="duration_minutes" required>
                  <option value="30">30 minutes</option>
                  <option value="45">45 minutes</option>
                  <option value="60">60 minutes</option>
                  <option value="90">90 minutes</option>
                </select>
              </label>
              <label>
                Price (£)
                <input type="number" name="price" min="0" step="0.5" placeholder="20" required />
              </label>
            </div>
            <label class="slot-notes">
              Highlight (optional)
              <input type="text" name="notes" placeholder="Sunset stroll, riverside route, etc." />
            </label>
            <div class="form-actions">
              <button type="submit" class="button secondary">Add slot</button>
              <p class="form-feedback" data-role="schedule-feedback"></p>
            </div>
          </form>
          <div class="schedule-columns">
            <section class="schedule-column">
              <div class="schedule-heading">
                <h3>Upcoming availability</h3>
                <span class="schedule-count" data-role="admin-slot-count">0</span>
              </div>
              <div class="schedule-list" data-role="admin-slot-list" aria-live="polite"></div>
              <p class="schedule-empty" data-role="admin-slot-empty">
                No open slots yet. Use the form above to publish your first glowing time slot.
              </p>
            </section>
            <section class="schedule-column">
              <div class="schedule-heading">
                <h3>Bookings</h3>
                <span class="schedule-count" data-role="admin-booking-count">0</span>
              </div>
              <div class="schedule-list" data-role="admin-booking-list" aria-live="polite"></div>
              <p class="schedule-empty" data-role="admin-booking-empty">
                Once a client reserves a walk, their details appear here for easy confirmations.
              </p>
            </section>
          </div>
        </div>
      </article>
      <article class="admin-card settings-card" data-card>
        <div
          class="card-preview"
          data-card-toggle
          role="button"
          tabindex="0"
          aria-expanded="false"
          aria-controls="settings-card-body"
        >
          <div class="card-preview__header">
            <span class="eyebrow">Chat Mode</span>
            <h2>Chat Mode &amp; Business Context</h2>
            <p class="card-subtitle">Toggle Autopilot and keep your business details current.</p>
          </div>
          <p class="card-summary-line" data-role="mode-description">
            Live chat is OFF — visitors chat with the AI assistant.
          </p>
          <span class="card-toggle-hint" aria-hidden="true">Update assistant</span>
        </div>
        <div class="card-body" id="settings-card-body" data-card-body hidden>
          <form id="chat-settings-form" class="settings-form">
            <div class="toggle-row">
              <label class="toggle">
                <input type="checkbox" id="autopilot-toggle" />
                <span class="toggle-track" aria-hidden="true"></span>
                <span class="toggle-label">Autopilot</span>
              </label>
              <p class="toggle-description" data-role="mode-description">
                Live chat is OFF — visitors chat with the AI assistant.
              </p>
            </div>
            <label class="field-label" for="business-context">Business Knowledge</label>
            <p class="field-help">
              Add bullet points, FAQs, pricing, or any notes you want the AI to use in its replies.
            </p>
            <textarea
              id="business-context"
              rows="8"
              placeholder="Opening hours, pricing, service areas, booking steps, etc."
            ></textarea>
            <div class="form-actions">
              <button type="submit" class="button primary">Save Settings</button>
              <p class="form-feedback" data-role="settings-feedback"></p>
            </div>
          </form>
        </div>
      </article>
      <article class="admin-card access-card" data-card data-role="ban-manager">
        <div
          class="card-preview"
          data-card-toggle
          role="button"
          tabindex="0"
          aria-expanded="false"
          aria-controls="access-card-body"
        >
          <div class="card-preview__header">
            <span class="eyebrow">Access Control</span>
            <h2>Visitor Access Control</h2>
            <p class="card-subtitle">Block disruptive visitors or reinstate access in seconds.</p>
          </div>
          <dl class="card-glance">
            <div class="card-glance__item">
              <dt>Active bans</dt>
              <dd class="card-glance__value" data-role="ban-count">0</dd>
            </div>
          </dl>
          <span class="card-toggle-hint" aria-hidden="true">Manage access</span>
        </div>
        <div class="card-body" id="access-card-body" data-card-body hidden>
          <form id="ban-visitor-form" class="ban-form">
            <div class="ban-form-grid">
              <label class="field-label" for="ban-identifier">Visitor identifier</label>
              <input
                id="ban-identifier"
                name="identifier"
                type="text"
                placeholder="IP address, email, or reference"
                autocomplete="off"
                required
              />
              <label class="field-label" for="ban-reason">Reason (optional)</label>
              <input
                id="ban-reason"
                name="reason"
                type="text"
                placeholder="Spam messages, abusive language, etc."
                autocomplete="off"
              />
              <button type="submit" class="button danger">Ban visitor</button>
            </div>
            <p class="form-feedback" data-role="ban-feedback"></p>
          </form>
          <div class="ban-list">
            <div class="ban-list-header">
              <h3>Restricted visitors</h3>
              <span class="status-pill" data-role="ban-count">0</span>
            </div>
            <p class="ban-empty" data-role="ban-empty">
              No visitors are currently banned.
            </p>
            <div class="table-wrapper">
              <table class="ban-table" data-role="ban-table">
                <thead>
                  <tr>
                    <th scope="col">Visitor</th>
                    <th scope="col">Status</th>
                    <th scope="col">Reason</th>
                    <th scope="col">Added</th>
                    <th scope="col" class="actions">Actions</th>
                  </tr>
                </thead>
                <tbody data-role="ban-table-body"></tbody>
              </table>
            </div>
          </div>
        </div>
      </article>
    </div>
  </div>
</section>
{% endblock %}
